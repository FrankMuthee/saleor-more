{% extends "web_shop/control_panel/control_panel.html" %}
{% load as_vertical_form from bootstrap %}
{% load i18n %}

{% block active_settings %}active{% endblock %}

{% block control_panel_content %}

    {% for message in messages %}
        <div class='alert alert-{%if message.tags == "error"%}danger{%else%}success{%endif%}'>
            {{message}}
        </div>
    {%endfor%}
    <div class="panel panel-default">
        <div id='personal-data' class="panel-body">
            <table>
                <tbody>
                    <tr>
                        <th>Nombre: </th>
                        <td>{{ user.user.name }}</td>
                    </tr>
                    <tr>
                        <th>Apellidos: </th>
                        <td>{{ user.user.last_name }}</td>
                    </tr>
                    <tr>
                        <th>Email: </th>
                        <td> {{ user.user }}</td>
                    </tr>
                    <tr>
                        <th>Contrase√±a: </th>
                        <td> ******</td>
                    </tr>
                </tbody>
            </table>
            <div id="settings-btns">
                <a href="#change-personal-info" data-toggle="collapse" data-target="#change-personal-info" class="btn btn-default cartbtn-orange">{% trans 'Cambiar Datos personales' %}</a>
            </div>
            <br/>
            <div class="row">
                <div class="col-sm-6">
                    <form id="change-personal-info" method="post" class="{% if form.errors %}{% else %}collapse{% endif %}" >
                        {% csrf_token %}
                        <div class="panel panel-default">
                            <div class="panel-body">
                                <fieldset>
                                    {{ form|as_vertical_form }}
                                    <input type="hidden" name="next" value="{{ next }}" />
                                </fieldset>

                                <div class="form-group">
                                    {% block form_submit %}
                                        <button type="submit" class="btn btn-default cartbtn-green">
                                            {% trans "Cambiar" %}
                                        </button>
                                    {% endblock %}
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    {% if address_book %}
            <h3>{% trans "Libreta de direcciones" %}</h3>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th class="col-sm-2">{% trans "Short alias" %}</th>
                        <th class="col-sm-4">{% trans "Addressee" %}</th>
                        <th class="col-sm-2">{% trans "Shipping" %}</th>
                        <th class="col-sm-2"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in address_book %}
                    <tr>
                        <th class="col-sm-2">
                            {{ entry }}
                        </th>
                        <td class="col-sm-4">
                            {{ entry.address }}
                        </td>
                        <td class="col-sm-2">
                            {% if user.default_shipping_address == entry %}
                            <span class="label label-default">{% trans "Default" %}</span>
                            {% else %}
                            <form method="post" action="{# url "profile:address-make-default" pk=entry.pk purpose="shipping" #}" class="form-inline form-horizontal">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-default btn-sm">{% trans "Make default" %}</button>
                            </form>
                            {% endif %}
                        </td>
                        <td class="col-sm-2">
                            <a href="{# url 'profile:address-edit' pk=entry.pk slug=entry.get_slug #}" class="btn btn-default btn-sm"><i class="glyphicon glyphicon-edit"></i> {% trans "Edit" %}</a>
                            <a href="{# url 'profile:address-delete' pk=entry.pk slug=entry.get_slug #}" class="btn btn-danger btn-sm"><i class="glyphicon glyphicon-remove"></i> {% trans "Delete" %}</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <div>
                <a href="{# url 'profile:address-create' #}" class="btn btn-default"><i class="glyphicon glyphicon-plus-sign"></i> {% trans "Add new address" %}</a>
            </div>
        {% endif %}
    <script>
        $(document).ready(function(){

                $('#change-personal-info .form-group.repeat_email').hide();
                $('#change-personal-info .form-group.repeat_password').hide();

                $('#change-personal-info #id_email').focus(function(){
                        $('.form-group.repeat_email').show(250);
                        });
                $('#change-personal-info #id_password').focus(function(){
                        $('.form-group.repeat_password').show(250);
                        });

                });
    </script>

{% endblock %}


